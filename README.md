# GPU Lab Monitor

研究室のGPUサーバー群を一元管理する監視ダッシュボードです。
各サーバーのGPU使用率、温度、電力、そして**現在誰が（どのDockerコンテナが）GPUを使用しているか**を可視化します。

SSHログインやパスワード管理は不要。IPアドレスを登録するだけで、Webブラウザからクラスタ全体の状況を把握できます。

---

## 🛠 前提条件

**管理者PC (フロントエンド表示用)**
- Node.js (v16以上推奨)
- Git

**監視対象GPUサーバー (バックエンドエージェント用)**
- Linux (Ubuntu等)
- NVIDIA Driver & nvidia-smi
- Python 3.x
- Docker (コンテナ情報の取得に必要)

---

## 🚀 セットアップ手順

### Step 1: リポジトリのクローン (管理者PC)

まず、ソースコードをローカル環境にダウンロードします。

```bash
# プロジェクトをクローン
git clone https://github.com/your-username/gpu-lab-monitor.git

# ディレクトリに移動
cd gpu-lab-monitor
```

---

### Step 2: 監視エージェントの構築 (GPUサーバー側)

**※この作業は、監視したい全てのGPUサーバーで行ってください。**

付属のセットアップスクリプトを使用すると、環境構築、ファイル配置、自動起動設定、ファイアウォール開放を一括で行えます。

1. **スクリプトをGPUサーバーに転送・実行**
   （git cloneしても良いですし、`setup_agent.sh` の中身をコピペしても構いません）

   ```bash
   # リポジトリ内にある setup_agent.sh に実行権限を付与
   chmod +x setup_agent.sh
   
   # root権限で実行
   sudo ./setup_agent.sh
   ```

2. **動作確認**
   スクリプトが正常終了すると、最後にエージェントのURLが表示されます。
   手元のブラウザからアクセスできるか確認してください。
   
   ```
   http://192.168.1.XX:8000/metrics
   ```
   ※ JSONデータが表示されれば成功です。

---

### Step 3: ダッシュボードアプリの起動 (管理者PC)

再び管理者PC（リポジトリをクローンしたPC）に戻ります。

#### 1. 依存ライブラリのインストール
```bash
npm install
```

#### 2. アプリの起動
開発モードで起動します。

```bash
npm start
```

ブラウザで `http://localhost:3000`（または表示されたURL）にアクセスします。
右上の「Add Server」ボタンから、Step 2で設定したサーバーのIPアドレス（例: `192.168.1.50`）を追加してください。

---

## ❓ トラブルシューティング

### Q. IPアドレスを追加しても "Connection lost" になる
1. **IPアドレスの確認:** 登録したIPが、アプリを開いているPCから到達可能か (`ping 192.168.1.XX`) 確認してください。
2. **ファイアウォール:** スクリプトは `ufw` を設定しますが、`firewalld` などの場合は手動でポート8000 (TCP) を開放してください。
3. **エージェント起動確認:** GPUサーバーで `sudo systemctl status gpu-monitor` を確認してください。
4. **Mixed Content:** GitHub Pages (HTTPS) を使用している場合、HTTPのエージェントには接続できません。詳細は `docs/GITHUB_PAGES.md` を参照してください。

### Q. Dockerのユーザー名が表示されない
エージェント (`gpu-monitor`) は root 権限で実行されるように設定されているため、通常は問題ありませんが、Dockerデーモンが停止している場合は表示されません。

### Q. LANスキャンが遅い / 見つからない
LANスキャン機能は、管理者PC（`npm start`しているPC）からネットワーク探索を行います。
管理者PCがGPUサーバーと同じLAN内に接続されていることを確認してください。